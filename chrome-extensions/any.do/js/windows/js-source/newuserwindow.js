define("jquery,underscore,backbone,mustache,helpers/view,windows/window,server/auth,text!templates/newuserwindow.html".split(","),function(c,d,k,h,b,i,g,j){return i.extend({className:"window form-window",events:{"submit form":"register","click .register":"register","click .back":"back","click .already":"alreadyMember","keypress .name":"goToName","keypress .email":"goToPassword","keypress .password":"goToLogin","focus :input":"clearErrors"},initialize:function(a){this.constructor.__super__.initialize.apply(this,
[a]);d.bindAll(this,"register")},goToName:function(a){a.keyCode==13&&c(this.el).find(".email").focus()},goToPassword:function(a){a.keyCode==13&&c(this.el).find(".password").focus()},goToLogin:function(a){a.keyCode==13&&this.login()},render:function(){var a=h.i18n_to_html(j,["enter_your_name","already","register","your_email","choose_a_password"]);c(this.el).html(a);this.nameField=c(this.el).find(".name");this.emailField=c(this.el).find(".email");this.passwordField=c(this.el).find(".password");return this},
register:function(){this.options.app.trackClick("New User Window","Register");this.clearErrors();var a=this.nameField.val(),e=this.emailField.val(),f=this.passwordField.val();if(this.options.app.validName(a))if(this.options.app.validEmail(e)){if(this.options.app.validPassword(f)){g.createUser(a,e,f,e,d.bind(function(){g.logIn(e,f,d.bind(function(){this.options.app.showTaskList();g.saveCredentials(e,f)},this),d.bind(function(){b.shake(this.passwordField)},this))},this),d.bind(function(){b.showError("<br>"+
getMessage("error_cant_register")+"<br><br>",c(this.el).find(".register"),"insertBefore")},this));return false}b.shake(this.passwordField);b.showError(getMessage("error_invalid_password"),this.passwordField,"insertBefore")}else{b.shake(this.emailField);b.showError(getMessage("error_invalid_email"),this.emailField,"insertBefore")}else{b.shake(this.nameField);b.showError(getMessage("error_invalid_name"),this.nameField,"insertBefore")}},alreadyMember:function(){this.options.app.trackClick("New User Window",
"Already A Member");c(this.el).hide();this.options.app.mainLoginWindow.show();this.options.app.trackPageview("/registerWindow")},clearErrors:function(){b.clearErrors()}})});