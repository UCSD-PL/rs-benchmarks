define(["jquery","underscore"],function(){function d(a){a=JSON.parse(a);return a.taskId?a.taskId:null}var e={};return{initializeAlerts:function(){chrome.notifications.onClosed.addListener(function(a,c){var b=d(a);c&&(chrome.runtime.sendMessage({action:"alert",alert:"dismiss",id:b}),track(["Notification","Manually Closed"]));e.closeCallback&&e.closeCallback(b)});chrome.notifications.onClicked.addListener(function(a){a=d(a);chrome.runtime.sendMessage({action:"popupWindow",highlightedTask:a});track(["Notification",
"Clicked Notification"])});chrome.notifications.onButtonClicked.addListener(function(a,c){var b=d(a);console.log("clicked on",c,"for task",b);0===c?(chrome.runtime.sendMessage({action:"alert",alert:"snooze",minutes:60,id:b}),track(["Notification","Clicked Snooze","1 hour"])):(chrome.runtime.sendMessage({action:"alert",alert:"done",id:b}),track(["Notification","Clicked Done"]));chrome.notifications.clear(a,function(){})})},updateTaskCounter:function(a){chrome.browserAction.setBadgeBackgroundColor({color:[225,
0,0,255]});a?chrome.browserAction.setBadgeText({text:a.toString()}):chrome.browserAction.setBadgeText({text:""})},showAlert:function(a,c){e.closeCallback=c;var b=JSON.stringify({taskId:a.id,due:a.alertTime});chrome.notifications.create(b,{type:"basic",iconUrl:chrome.runtime.getURL("images/bell.png"),title:a.title,message:a.formattedTime+", "+a.category,eventTime:a.alertTime,buttons:[{title:"Snooze 1 hour",iconUrl:chrome.runtime.getURL("images/snooze.png")},{title:"Done",iconUrl:chrome.runtime.getURL("images/done.png")}]},
function(){track(["Notification","Shown"])})}}});