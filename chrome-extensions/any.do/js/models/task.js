define(["jquery","underscore","backbone","constants"],function(g,e,f){return f.Model.extend({toggle:function(a){var b={};b[a]=!this.get(a);this.save(b)},defaults:function(){var a=(new Date).getTime();return{title:null,listPositionByCategory:0,listPositionByPriority:0,listPositionByDueDate:0,status:TaskStatus.UNCHECKED,repeatingMethod:TASK_REPEAT.TASK_REPEAT_OFF,shared:!1,priority:TaskPriority.Normal,creationDate:a,taskExpanded:!1}},initialize:function(){e.bindAll(this,"getListPosition","setListPosition",
"getMatchingDueDateCategory","setDueDateCategory","dismissAlert","markAsChecked","snoozeTask","validStatus","getCategoryName","checkReminder");this.on("change:alert",this.checkReminder);this.on("change:dueDate",this.checkReminder);this.on("change:status",this.checkReminder)},checkReminder:function(){if(this.get("lastUpdateDate")===this._previousAttributes.lastUpdateDate&&(console.log("task changed! details:",this,this.get("lastUpdateDate"),this._previousAttributes.lastUpdateDate),this.get("status")!=
this.previousAttributes.status||JSON.stringify(this.get("alert"))!=JSON.stringify(this.previousAttributes.alert)||this.get("dueDate")!=this.previousAttributes.dueDate))console.log("alert-relevant data has been changed for task",this.get("id")),chrome.runtime.sendMessage({action:"refresh",task:this.toJSON()})},getListPosition:function(a){a||(a=app.userConfig.getView());return this.get(LIST_POSITION_KEY[a])},setListPosition:function(a){var b={};b[LIST_POSITION_KEY[app.userConfig.getView()]]=a;this.save(b)},
getMatchingDueDateCategory:function(){var a=this.get("dueDate");if(null!=a){var b=new Date;b.setMilliseconds(0);b.setSeconds(0);b.setMinutes(0);b.setHours(0);var c=b.getTime(),b=c+DAY_SECONDS,c=c+2*DAY_SECONDS;return a<b?DATE_CATEGORY_TODAY:a>=b&&a<c?DATE_CATEGORY_TOMORROW:a>=c?DATE_CATEGORY_UPCOMING:DATE_CATEGORY_SOMEDAY}return DATE_CATEGORY_SOMEDAY},setFolderCategory:function(a){var b={};b.categoryId=a;b[LIST_POSITION_KEY[VIEW_BY_CATEGORY]]=0;this.save(b)},setPriorityCategory:function(a){var b=
{};b.priority=a;b[LIST_POSITION_KEY[VIEW_BY_PRIORITY]]=0;this.save(b)},setDueDateCategory:function(a){var b=void 0,c={};if(a===DATE_CATEGORY_SOMEDAY)c.alert=null;else{var d=this.get("dueDate")?new Date(this.get("dueDate")):new Date,b=d.getSeconds(),e=d.getMinutes(),d=d.getHours(),a=this.collection.generateDueDate(a);a.setSeconds(b);a.setMinutes(e);a.setHours(d);b=a.getTime()}c.dueDate=b;c[LIST_POSITION_KEY[VIEW_BY_DUE_DATE]]=0;this.save(c)},validStatus:function(){return this.get("status")==TaskStatus.CHECKED||
this.get("status")==TaskStatus.UNCHECKED},getCategoryName:function(){var a=app.mainTaskWindow.categories.get(this.get("categoryId"));return a?a.get("name"):"N/A"},markAsChecked:function(){this.save({status:TaskStatus.CHECKED})},dismissAlert:function(a){this.save({alert:{type:"NONE",offset:0}},{success:a})},snoozeTask:function(a){this.save({dueDate:Date.now()+a,alert:{type:"OFFSET",offset:0,customTime:0}})}})});