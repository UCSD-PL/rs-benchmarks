require(["jquery","server/sync","server/auth","constants"],function(g,e,h){function c(b,a,c,d,j,e){var f;g.ajax({async:!1,cache:!1,timeout:3E4,url:b+e,type:a,dataType:"json",contentType:"application/json",data:JSON.stringify(c),success:function(a){f=a},error:function(a){f=a}});return f}function i(b,a,c){var d;g.ajax({async:!1,cache:!1,timeout:3E4,url:b,type:a,dataType:"json",data:c,success:function(a){d=a},error:function(a){d=a}});return d}function d(b,a){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c]}
module("Auth");test("Create a user",function(){error=function(b){ok(409==b.status,"user exists")};h.createUser("Ron Reiter","ron.reiter@gmail.com","123456","ron.reiter@gmail.com",null,error)});test("Log in",function(){h.logIn("ron.reiter@gmail.com","123456",function(b){console.log("yay");ok(302==b.status,"logged in successfully")},function(b){console.log("whoops");equals(b.status,302,"logged in successfully")})});test("Log in with Facebook Connect",function(){FB.init({appId:218307504870310,status:!0,
cookie:!0,xfbml:!0});FB.login(function(b){b.authResponse?(console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(a){console.log("Good to see you, "+a.name+".");data={access_token:a.session.access_token,_spring_security_remember_me:"on"};output=i(facebookUrl,"post",data,null);ok(302==output.status,"logged in successfully");FB.logout(function(){console.log("Logged out.")})})):console.log("User cancelled login or did not fully authorize.")},{scope:"email"})});module("Tasks");test("Create a new task",
function(){var b=e.createGlobalId(),a=(new Date).getTime();c(TASKS_URL,"post",[{id:b,title:"Eat",category:"Personal",creationDate:a,priority:"Normal",status:"UNCHECKED"}],void 0,void 0,"");a=c(TASKS_URL,"get",null,void 0,void 0,"");a=d(a,b);ok("Eat"==a.title,"Task title retrieved");a.title="Drink";c(TASKS_URL+"/"+b,"put",a,void 0,void 0,"");a=c(TASKS_URL,"get",null,void 0,void 0,"");ok("Drink"==d(a,b).title,"Task updated");a=c(TASKS_URL+"/"+b,"delete",void 0,void 0,void 0,"");ok(null==a,"Task deleted");
a=c(TASKS_URL,"get",null,void 0,void 0,"");ok(void 0===d(a,b),"Task deleted successfully")});module("Categories");test("Create a new category",function(){var b=e.createGlobalId(),a;a=c(CATEGORIES_URL,"post",[{id:b,isDefault:!1,name:"Personal"}],void 0,void 0,"");ok(null!=a,"Created category");a=c(CATEGORIES_URL,"get",null,void 0,void 0,"");a=d(a,b);ok("Personal"==a.name,"Category name retrieved");a.name="Taskos";c(CATEGORIES_URL+"/"+b,"put",a,void 0,void 0,"");a=c(CATEGORIES_URL,"get",null,void 0,
void 0,"");a=d(a,b);ok("Taskos"==a.name,"Cateogry updated");a=c(CATEGORIES_URL+"/"+b,"delete",void 0,void 0,void 0,"");ok(null==a,"Category deleted");a=c(CATEGORIES_URL,"get",null,void 0,void 0,"");ok(void 0===d(a,b),"Category deleted successfully")})});